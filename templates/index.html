<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Fashion Assistant</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f7; color: #333; }
header { background: #1a1a1a; color: #fff; padding: 20px; text-align: center; font-size: 2rem; }
main { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
form { display: flex; gap: 10px; margin-bottom: 20px; }
input[type="file"] { flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
button { background: #ff6f61; color: #fff; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; transition: 0.3s; }
button:hover { background: #ff3b2f; }
#analysis { margin: 20px 0; font-size: 1.1rem; font-weight: bold; }
#products { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }

/* Product Card */
.product-card {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.product-card img {
    width: 100%;
    height: 250px;
    object-fit: cover; /* Fill div fully, crop if necessary */
    display: block;
}

.product-card-content {
    padding: 10px;
}

.product-card-content a {
    text-decoration: none;
    color: #1a1a1a;
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
}

.product-card-content div {
    font-size: 0.9rem;
    color: #666;
}

/* Chat Section */
#chat-container { margin-top: 40px; }
#chat-box { background: #fff; padding: 15px; border-radius: 10px; height: 350px; overflow-y: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.msg { margin: 10px 0; max-width: 70%; padding: 10px 15px; border-radius: 20px; word-wrap: break-word; }
.user { background: #ff6f61; color: #fff; margin-left: auto; text-align: right; }
.ai { background: #e2e2e2; color: #333; margin-right: auto; }
#chat-input { display: flex; gap: 10px; margin-top: 10px; }
#userInput { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; }

@media (max-width: 600px) {
    .product-card img { height: 180px; }
}
</style>
</head>
<body>

<header>AI Fashion Assistant</header>
<main>

<form id="uploadForm" enctype="multipart/form-data">
    <input type="file" name="image" required />
    <button type="submit">Upload & Analyze</button>
</form>

<div id="analysis"></div>
<div id="products"></div>

<div id="chat-container">
    <h2>Chat with AI</h2>
    <div id="chat-box"></div>
    <div id="chat-input">
        <input type="text" id="userInput" placeholder="Ask for style advice..." />
        <button id="sendBtn">Send</button>
    </div>
</div>

<script>
const chatBox = document.getElementById('chat-box');
const analysisDiv = document.getElementById('analysis');
const productsDiv = document.getElementById('products');

document.getElementById('uploadForm').onsubmit = async function(e){
    e.preventDefault();
    let formData = new FormData(this);
    let res = await fetch('/upload', { method: 'POST', body: formData });
    let data = await res.json();

    if(data.status === "ok"){
        const { morphotype, head_shape } = data.analysis;
        analysisDiv.innerText = `Detected morphotype: ${morphotype}\nDetected head shape: ${head_shape}`;

        productsDiv.innerHTML = '';
        if(data.products && data.products.length > 0){
            data.products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <img src="${p.image || 'https://via.placeholder.com/250'}" alt="${p.title}" />
                    <div class="product-card-content">
                        <a href="${p.url || '#'}" target="_blank">${p.title}</a>
                        <div>Price: ${p.price || 'N/A'} ${p.currency || ''}</div>
                        <div>Tags: ${p.tags && p.tags.length ? p.tags.join(', ') : 'None'}</div>
                    </div>
                `;
                productsDiv.appendChild(card);
            });
        } else {
            productsDiv.innerHTML = '<p>No products found for your body shape yet.</p>';
        }

    } else {
        analysisDiv.innerText = data.message || "Upload failed.";
    }
};

document.getElementById('sendBtn').onclick = async function(){
    let msg = document.getElementById('userInput').value.trim();
    if(!msg) return;
    chatBox.innerHTML += `<div class="msg user">${msg}</div>`;
    document.getElementById('userInput').value = "";

    let res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg })
    });
    let data = await res.json();
    chatBox.innerHTML += `<div class="msg ai">${data.response.replace(/\n/g,'<br>')}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
};
</script>

</main>
</body>
</html>
